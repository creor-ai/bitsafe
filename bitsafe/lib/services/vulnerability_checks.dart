import '../models/transaction.dart';
import '../models/address_details.dart';

class VulnerabilityChecks {
  // This method will check for address reuse in the list of transactions
  static void checkAddressReuse(List<Transaction> transactions, AddressDetails details) {
    var seenAddresses = <String>{};
    bool hasReuse = false;

    for (var transaction in transactions) {
      for (var input in transaction.inputs) {
        if (!seenAddresses.add(input.address) && input.address == details.address) {
          hasReuse = true;
          break;
        }
      }
      for (var output in transaction.outputs) {
        if (!seenAddresses.add(output.address) && output.address == details.address) {
          hasReuse = true;
          break;
        }
      }
      if (hasReuse) break;
    }

    details.updateAddressReuse(hasReuse);
  }

  // This method will check for common patterns of dust transactions
  static void checkDustTransactions(List<Transaction> transactions, AddressDetails details) {
    bool hasDustTransactions = transactions.any((transaction) => transaction.outputs.any((output) => output.address == details.address && output.amount < 0.00001));

    details.updateDustTransactions(hasDustTransactions);
  }

  // Add additional methods for other checks as needed
  // Example: checkCompromisedLinks, checkUnusualPatterns, etc.

  // A method to run all checks
  static void runAllChecks(List<Transaction> transactions, AddressDetails details) {
    checkAddressReuse(transactions, details);
    checkDustTransactions(transactions, details);
    // Call other check methods here
  }
}
